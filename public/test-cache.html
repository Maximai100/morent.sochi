<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫—ç—à–∞ MORENT</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∫—ç—à–∞ MORENT</h1>
    <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫—ç—à–∞.</p>
    
    <div id="results"></div>
    
    <button onclick="runTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
    <button onclick="clearAllCache()">–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à</button>
    <button onclick="checkServiceWorker()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Service Worker</button>
    <button onclick="testApartmentLink()">–¢–µ—Å—Ç —Å—Å—ã–ª–∫–∏ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞</button>
    
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }
        
        async function runTests() {
            document.getElementById('results').innerHTML = '';
            addResult('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'info');
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            try {
                const response = await fetch('/version.json?t=' + Date.now());
                const version = await response.json();
                addResult(`‚úÖ –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ${version.version} (${version.timestamp})`, 'success');
            } catch (e) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä—Å–∏–∏: ${e.message}`, 'error');
            }
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                if (registrations.length > 0) {
                    addResult(`‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${registrations.length} —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π`, 'success');
                } else {
                    addResult(`‚ö†Ô∏è Service Worker –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                }
            } else {
                addResult(`‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è`, 'error');
            }
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–µ–π
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                addResult(`üì¶ –ù–∞–π–¥–µ–Ω–æ –∫—ç—à–µ–π: ${cacheNames.length}`, 'info');
                cacheNames.forEach(name => {
                    addResult(`- ${name}`, 'info');
                });
            }
            
            // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
            const appVersion = localStorage.getItem('app_version');
            if (appVersion) {
                addResult(`üíæ –í–µ—Ä—Å–∏—è –≤ localStorage: ${appVersion}`, 'info');
            } else {
                addResult(`üíæ –í–µ—Ä—Å–∏—è –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, 'info');
            }
            
            // –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const urlParams = new URLSearchParams(window.location.search);
            const params = Array.from(urlParams.entries());
            if (params.length > 0) {
                addResult(`üîó URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: ${JSON.stringify(Object.fromEntries(params))}`, 'info');
            } else {
                addResult(`üîó URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç`, 'info');
            }
            
            addResult('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 'success');
        }
        
        async function clearAllCache() {
            try {
                // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫—ç—à–µ–π
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                    addResult(`‚úÖ –û—á–∏—â–µ–Ω–æ –∫—ç—à–µ–π: ${cacheNames.length}`, 'success');
                }
                
                // –û—á–∏—Å—Ç–∫–∞ storage
                localStorage.clear();
                sessionStorage.clear();
                addResult('‚úÖ localStorage –∏ sessionStorage –æ—á–∏—â–µ–Ω—ã', 'success');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Service Worker
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        await registration.unregister();
                    }
                    addResult('‚úÖ Service Worker –æ—Ç–∫–ª—é—á–µ–Ω', 'success');
                }
                
                addResult('üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'info');
            } catch (e) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞: ${e.message}`, 'error');
            }
        }
        
        async function checkServiceWorker() {
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                addResult(`Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π: ${registrations.length}`, 'info');
                
                registrations.forEach((reg, index) => {
                    addResult(`–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ${index + 1}:`, 'info');
                    addResult(`- Scope: ${reg.scope}`, 'info');
                    addResult(`- State: ${reg.active?.state || '–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω'}`, 'info');
                    addResult(`- Script URL: ${reg.active?.scriptURL || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`, 'info');
                });
            }
        }
        
        function testApartmentLink() {
            const testId = 'test-apartment-123';
            const testUrl = `${window.location.origin}/apartment/${testId}?guest=–¢–µ—Å—Ç&checkin=01.01.2024&checkout=02.01.2024`;
            addResult(`üîó –¢–µ—Å—Ç–æ–≤–∞—è —Å—Å—ã–ª–∫–∞: <a href="${testUrl}" target="_blank">${testUrl}</a>`, 'info');
            
            // –¢–∞–∫–∂–µ —Ç–µ—Å—Ç –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            const homeUrl = `${window.location.origin}/?apartment=${testId}&guest=–¢–µ—Å—Ç`;
            addResult(`üè† –ì–ª–∞–≤–Ω–∞—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: <a href="${homeUrl}" target="_blank">${homeUrl}</a>`, 'info');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            addResult('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã" –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.', 'info');
        });
    </script>
</body>
</html>