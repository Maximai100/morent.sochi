<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ MORENT</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto; 
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0C2D5A;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #0a2347; }
        
        #console-output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        
        .test-link {
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-decoration: none;
            color: #333;
        }
        .test-link:hover {
            background: #0C2D5A;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ MORENT</h1>
        
        <div class="info">
            <strong>–¶–µ–ª—å:</strong> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
        </div>

        <div id="status-container">
            <!-- –°—Ç–∞—Ç—É—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <h3>üß™ –¢–µ—Å—Ç—ã</h3>
        <button onclick="testConsoleOutput()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
        <button onclick="testServiceWorker()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Service Worker</button>
        <button onclick="testDirectus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Directus</button>
        <button onclick="clearConsole()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>

        <h3>üìã –í—ã–≤–æ–¥ –∫–æ–Ω—Å–æ–ª–∏</h3>
        <div id="console-output">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å" –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...</div>

        <h3>üîó –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏</h3>
        <a href="/apartment/d322e513-df6a-4bcf-ba7d-d006ab9a3f6c?guest=–¢–µ—Å—Ç&checkin=26.09.2025&checkout=27.09.2025" class="test-link">
            <strong>–†–µ–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞</strong>
            <small>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</small>
        </a>
        
        <a href="/" class="test-link">
            <strong>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</strong>
            <small>–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</small>
        </a>
    </div>

    <script>
        let consoleMessages = [];
        let originalConsole = {};

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Å–æ–ª–∏
        function interceptConsole() {
            ['log', 'info', 'warn', 'error', 'debug'].forEach(method => {
                originalConsole[method] = console[method];
                console[method] = function(...args) {
                    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    consoleMessages.push({
                        method: method,
                        args: args,
                        timestamp: new Date().toISOString(),
                        size: JSON.stringify(args).length
                    });
                    
                    // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
                    originalConsole[method].apply(console, args);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–≤–æ–¥
                    updateConsoleOutput();
                };
            });
        }

        function restoreConsole() {
            ['log', 'info', 'warn', 'error', 'debug'].forEach(method => {
                if (originalConsole[method]) {
                    console[method] = originalConsole[method];
                }
            });
        }

        function updateConsoleOutput() {
            const output = document.getElementById('console-output');
            const recent = consoleMessages.slice(-20); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π
            
            output.innerHTML = recent.map(msg => {
                const sizeWarning = msg.size > 1000 ? ' ‚ö†Ô∏è –ë–û–õ–¨–®–û–ô –û–ë–™–ï–ö–¢' : '';
                return `[${msg.timestamp.split('T')[1].split('.')[0]}] ${msg.method.toUpperCase()}: ${JSON.stringify(msg.args).substring(0, 200)}${msg.args.length > 200 ? '...' : ''}${sizeWarning}`;
            }).join('\n');
            
            output.scrollTop = output.scrollHeight;
        }

        function addStatus(type, message) {
            const container = document.getElementById('status-container');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function testConsoleOutput() {
            consoleMessages = [];
            addStatus('info', 'üîç –ù–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Å–æ–ª–∏...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const messageCount = consoleMessages.length;
                const largeMessages = consoleMessages.filter(msg => msg.size > 1000).length;
                
                if (messageCount > 50) {
                    addStatus('error', `‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏: ${messageCount} –∑–∞ 5 —Å–µ–∫—É–Ω–¥`);
                } else if (largeMessages > 0) {
                    addStatus('warning', `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${largeMessages} –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏`);
                } else if (messageCount < 10) {
                    addStatus('success', `‚úÖ –ö–æ–Ω—Å–æ–ª—å —á–∏—Å—Ç–∞—è: ${messageCount} —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 5 —Å–µ–∫—É–Ω–¥`);
                } else {
                    addStatus('info', `‚ÑπÔ∏è –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${messageCount} –∑–∞ 5 —Å–µ–∫—É–Ω–¥`);
                }
            }, 5000);
        }

        function testServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length === 0) {
                        addStatus('success', '‚úÖ Service Worker –æ—Ç–∫–ª—é—á–µ–Ω (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π)');
                    } else {
                        addStatus('warning', `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${registrations.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö Service Worker`);
                        registrations.forEach((reg, index) => {
                            addStatus('info', `SW ${index + 1}: ${reg.scope} (${reg.active?.state || '–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω'})`);
                        });
                    }
                });
            } else {
                addStatus('error', '‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }
        }

        function testDirectus() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Directus
            const hasDirectusUrl = window.location.origin.includes('morent-sochi');
            if (hasDirectusUrl) {
                addStatus('success', '‚úÖ Directus –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production');
            } else {
                addStatus('info', '‚ÑπÔ∏è –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏');
            }
        }

        function clearConsole() {
            consoleMessages = [];
            document.getElementById('console-output').innerHTML = '–ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞...';
            document.getElementById('status-container').innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            interceptConsole();
            addStatus('info', 'üöÄ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –∫–æ–Ω—Å–æ–ª–∏
            setTimeout(testConsoleOutput, 1000);
        });

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', restoreConsole);
    </script>
</body>
</html>